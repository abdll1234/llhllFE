<div class="upload-container py-4">
  @if (!state().result) {
    <!-- Header -->
    <div class="text-center mb-4">
      <div class="mb-3" style="font-size: 3rem;">ðŸŒ™</div>
      <h2 class="fw-bold" style="color: #1a4731;">Upload Halal Certificate</h2>
      <p class="text-muted">Upload your certificate and get a QR code instantly</p>
    </div>

    <div class="card">
      <div class="card-body p-4 p-md-5">

        <!-- Drop Area -->
        <div class="file-drop-area" (click)="fileInput.click()">
          <input #fileInput type="file" (change)="onFileSelected($event)"
                 accept=".pdf,.jpg,.jpeg,.png,.gif" hidden>
          @if (!fileInfo()) {
            <div>
              <div style="font-size: 3rem; color: #00a550;">ðŸ“„</div>
              <p class="mt-2 mb-1 fw-semibold" style="color: #1a4731;">
                Drag file here or click to browse
              </p>
              <p class="small text-muted mb-0">PDF, JPG, PNG â€“ max. 10 MB</p>
            </div>
          } @else {
            <div class="d-flex align-items-center justify-content-center gap-3 flex-wrap">
              <span style="font-size: 2.5rem;">{{ fileInfo()?.icon }}</span>
              <div class="text-start">
                <p class="mb-0 fw-semibold" style="color: #1a4731;">{{ fileInfo()?.name }}</p>
                <p class="mb-0 small text-muted">{{ fileInfo()?.size }}</p>
              </div>
              <button class="btn btn-sm btn-outline-danger"
                      (click)="$event.stopPropagation(); closeButton()">
                âœ•
              </button>
            </div>
          }
        </div>

        <!-- Name Field -->
        <div class="mb-3">
          <label class="form-label fw-semibold" style="color: #1a4731;">
            ðŸ‘¤ Your Name (optional)
          </label>
          <input type="text"
                 class="form-control allhalals-input"
                 placeholder="e.g. Ahmed Al-Rashid"
                 [(ngModel)]="state().uploaderName">
        </div>

        <!-- Invite Code Field -->
        <div class="mb-4">
          <label class="form-label fw-semibold" style="color: #1a4731;">
            ðŸ”‘ Invite Code *
          </label>
          <input type="text"
                 class="form-control allhalals-input"
                 placeholder="Enter invite code"
                 [(ngModel)]="state().inviteCode">
        </div>

        <!-- Upload Button -->
        <button class="btn btn-primary w-100 py-3 fw-bold fs-6"
                (click)="uploadFile()"
                [disabled]="!state().file || !state().inviteCode || state().isUploading">
          @if (state().isUploading) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            Uploading...
          } @else {
            âœ… Upload Certificate
          }
        </button>

      </div>
    </div>

  } @else {
    <!-- Success State -->
    <div class="success-card">
      <div class="text-center mb-4">
        <div style="font-size: 3rem;">âœ…</div>
        <h2 class="fw-bold mt-2" style="color: #1a4731;">Successfully uploaded!</h2>
        <p class="text-muted">Your Halal certificate has been saved</p>
      </div>

      <div class="card">
        <div class="card-body p-4">

          <!-- QR Code -->
          <div class="text-center mb-4">
            <h5 class="fw-bold mb-3" style="color: #1a4731;">ðŸ”² Your QR-Code</h5>
            @if (qrCodeUrl()) {
              <div class="qr-wrapper">
                <img [src]="qrCodeUrl()" alt="QR Code" />
              </div>
              <div class="mt-3">
                <button class="btn btn-primary px-4" (click)="downloadQRCode()">
                  â¬‡ Download QR-Code
                </button>
              </div>
            } @else {
              <div class="d-flex align-items-center justify-content-center gap-2 text-muted">
                <span class="spinner-border spinner-border-sm"></span>
                Generating QR-Code...
              </div>
            }
          </div>

          <!-- View URL -->
          <div class="mb-3">
            <label class="form-label fw-semibold" style="color: #1a4731;">ðŸ”— Certificate Link</label>
            <div class="d-flex gap-2">
              <div class="result-url-box flex-grow-1">{{ state().result?.viewUrl }}</div>
              <button class="btn btn-outline-primary px-3"
                      (click)="copyToClipboard(state().result?.viewUrl || '')">
                ðŸ“‹
              </button>
            </div>
          </div>

          <!-- Reset Button -->
          <button class="btn btn-outline-secondary w-100 mt-2" (click)="resetForm()">
            â†© Upload another certificate
          </button>

        </div>
      </div>
    </div>
  }
</div>
