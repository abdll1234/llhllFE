<!-- src/app/components/upload/upload.component.html -->
<div class="upload-container py-4">
  @if (!state().result) {
    <div class="card border-0 shadow-sm">
      <div class="card-body p-4 p-md-5">
        <div class="text-center mb-4">
          <h2 class="fw-bold">Upload File</h2>
          <p class="text-muted">Share files instantly with QR codes</p>
        </div>

        <!-- File Drop Area -->
        <div class="file-drop-area" (click)="fileInput.click()">
          <input #fileInput type="file" (change)="onFileSelected($event)" accept=".pdf,.jpg,.jpeg,.png,.gif" hidden>

          <span class="file-icon-display">
            {{ fileInfo()?.icon || 'üìÅ' }}
          </span>

          <h4 class="mb-2">{{ fileInfo() ? 'File Selected' : 'Select a file' }}</h4>
          <p class="text-muted small mb-0">{{ fileInfo() ? fileInfo()!.name + ' (' + fileInfo()!.size + ')' : 'PDF, JPG, PNG, GIF up to 50MB' }}</p>
        </div>

        <!-- Selected File Info -->
        @if (fileInfo()) {
          <div class="d-flex align-items-center bg-light p-3 rounded-3 mb-4">
            <div class="fs-2 me-3">{{ fileInfo()!.icon }}</div>
            <div class="flex-grow-1 min-width-0">
              <h6 class="mb-0 text-truncate">{{ fileInfo()!.name }}</h6>
              <small class="text-muted">{{ fileInfo()!.size }}</small>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger border-0" (click)="closeButton()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        }

        <!-- Form Fields -->
        <div class="row g-3 mb-4">
          <div class="col-12">
            <label class="form-label small fw-semibold text-muted text-uppercase">Your Name (Optional)</label>
            <div class="input-group">
              <span class="input-group-text bg-white border-end-0"><i class="bi bi-person text-muted"></i></span>
              <input type="text" class="form-control border-start-0 ps-0"
                     [(ngModel)]="state().uploaderName" placeholder="Anonymous">
            </div>
          </div>

          <div class="col-12">
            <label class="form-label small fw-semibold text-muted text-uppercase">Invite Code *</label>
            <div class="input-group">
              <span class="input-group-text bg-white border-end-0"><i class="bi bi-shield-lock text-muted"></i></span>
              <input type="text" class="form-control border-start-0 ps-0"
                     [(ngModel)]="state().inviteCode" placeholder="Enter invite code" required>
            </div>
            <div class="form-text small">Ask for an invite code to upload</div>
          </div>
        </div>

        <!-- Upload Button -->
        <button class="btn btn-primary btn-lg w-100 py-3 shadow-sm d-flex align-items-center justify-content-center gap-2"
                [disabled]="!state().file || !state().inviteCode || state().isUploading"
                (click)="uploadFile()">
          @if (state().isUploading) {
            <span class="spinner-border spinner-border-sm" role="status"></span>
            <span>Uploading...</span>
          } @else {
            <i class="bi bi-cloud-arrow-up-fill fs-5"></i>
            <span>Upload & Generate QR Code</span>
          }
        </button>
      </div>
    </div>
  } @else {
    <!-- Success View -->
    <div class="success-card text-center">
      <div class="card border-0 shadow-lg p-4 p-md-5 rounded-4">
        <div class="mb-4">
          <div class="display-1 text-success mb-3">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <h2 class="fw-bold">Upload Successful!</h2>
        </div>

        <!-- File Preview -->
        <div class="mb-4 p-3 bg-light rounded-4 d-inline-block mw-100">
          @if (state().result!.fileUrl.includes('image')) {
            <img [src]="state().result!.fileUrl" [alt]="state().result!.fileName" class="img-fluid preview-img shadow-sm">
          } @else {
            <div class="py-4 px-5">
              <div class="display-4 mb-2">{{ state().result!.fileUrl.includes('pdf') ? 'üìÑ' : 'üìÅ' }}</div>
              <p class="mb-0 fw-medium">{{ state().result!.fileName }}</p>
            </div>
          }
        </div>

        <!-- Share Link -->
        <div class="mb-4 text-start">
          <label class="form-label small fw-semibold text-muted text-uppercase">Share Link</label>
          <div class="input-group shadow-sm">
            <input type="text" class="form-control bg-white border-end-0 font-monospace" [value]="state().result!.viewUrl" readonly>
            <button class="btn btn-outline-primary px-3" (click)="copyToClipboard(state().result!.viewUrl)">
              <i class="bi bi-copy"></i>
            </button>
          </div>
        </div>

        <!-- QR Code -->
        <div class="mb-5">
          <h5 class="fw-bold mb-3">Scan QR Code</h5>
          <div class="qr-wrapper mb-3">
            <div #canvas></div>
          </div>
          <p class="text-muted small">Scan with your phone camera to view the file</p>
        </div>

        <!-- Actions -->
        <div class="d-grid d-md-flex gap-3 justify-content-center">
          <button class="btn btn-primary btn-lg px-4 shadow-sm d-flex align-items-center gap-2" (click)="downloadQRCode()">
            <i class="bi bi-download"></i>
            Download QR
          </button>
          <button class="btn btn-outline-secondary btn-lg px-4 d-flex align-items-center gap-2" (click)="resetForm()">
            <i class="bi bi-plus-lg"></i>
            Upload Another
          </button>
        </div>
      </div>
    </div>
  }
</div>
